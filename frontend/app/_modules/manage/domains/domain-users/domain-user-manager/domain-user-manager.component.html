<!-- Header with the badge -->
<header class="d-flex flex-wrap align-items-center">
    <h1 class="mb-0 me-2" i18n="heading">Domain</h1>
    <app-domain-badge></app-domain-badge>
</header>

<!-- Info block -->
<app-info-block *ngIf="domainMeta?.userKind" [ngSwitch]="domainMeta!.userKind">
    <ng-container *ngSwitchCase="'superuser'" i18n>As a superuser, you see all users registered on the domain, just like domain owners.</ng-container>
    <ng-container *ngSwitchCase="'owner'"     i18n>As a domain owner, you see all users registered on the domain. Other types of users don't have access to this page.</ng-container>
</app-info-block>

<div [appSpinner]="loading.active" spinnerSize="lg">
    <!-- Toolbar -->
    <div class="mb-3">
        <div class="row g-2 flex-grow-1">
            <!-- Placeholder to push other items to the right -->
            <div class="col"></div>

            <!-- Sort -->
            <div class="col-auto">
                <app-sort-selector [sort]="sort">
                    <app-sort-property by="email"   label="Email"   i18n-label></app-sort-property>
                    <app-sort-property by="name"    label="Name"    i18n-label></app-sort-property>
                    <app-sort-property by="created" label="Created" i18n-label></app-sort-property>
                </app-sort-selector>
            </div>

            <!-- Filter form -->
            <form [formGroup]="filterForm" class="col-12 col-sm-auto">
                <!-- Substring filter -->
                <div class="col-sm-auto">
                    <input formControlName="filter" id="filterString" class="form-control" type="search"
                           placeholder="Filter" aria-label="Filter" i18n-placeholder i18n-aria-label>
                </div>
            </form>
        </div>
    </div>

    <ng-container *ngIf="domainUsers?.length">
        <!-- Page list -->
        <div class="list-group">
            <a *ngFor="let du of domainUsers" [routerLink]="du.userId"
               class="list-group-item list-group-item-action d-flex">
                <ng-container *ngIf="userMap.get(du.userId!) as u">
                    <!-- Avatar -->
                    <div class="col-auto d-flex align-items-center pe-2">
                        <app-user-avatar [user]="u" size="M"></app-user-avatar>
                    </div>
                    <div class="col">
                        <!-- Name and badges -->
                        <div>
                            <!-- Name -->
                            <span class="fw-bold">{{ u.name }}</span>
                            <!-- Domain user badge -->
                            <app-domain-user-badge [domainUser]="du" class="ms-2"></app-domain-user-badge>
                            <!-- Superuser badge -->
                            <span *ngIf="u.isSuperuser" class="badge rounded-pill bg-danger ms-2" i18n>Super</span>
                            <!-- Banned badge -->
                            <span *ngIf="u.banned" class="badge rounded-pill bg-warning border border-danger text-danger ms-2">
                                <fa-icon [icon]="faBan" class="me-1"></fa-icon>
                                <ng-container i18n>Banned</ng-container>
                            </span>
                            <!-- Current user badge -->
                            <app-current-user-badge [userId]="u.id" class="ms-2"></app-current-user-badge>
                        </div>
                        <!-- Provider icon and email -->
                        <div>
                            <app-idp-icon *ngIf="!u.federatedSso && u.federatedIdP" [idpId]="u.federatedIdP" class="me-2"></app-idp-icon>
                            <span *ngIf="u.federatedSso" class="badge rounded-pill border border-dark text-dark me-2">SSO</span>
                            <ng-container>{{ u.email }}</ng-container>
                        </div>
                    </div>
                </ng-container>
            </a>
        </div>

        <!-- Item count -->
        <div class="py-2 text-center small text-muted">
            <ng-container *ngIf="!canLoadMore" i18n>All</ng-container>&ngsp;<ng-container>{{ domainUsers!.length }}</ng-container>&nbsp;<ng-container i18n>items displayed</ng-container>
        </div>

        <!-- Load more items button -->
        <div *ngIf="canLoadMore" class="py-2 text-center">
            <button type="button" (click)="load.next(false)" class="btn btn-outline-secondary">
                <ng-container i18n>Load more</ng-container>
            </button>
        </div>
    </ng-container>

    <!-- Nothing found placeholder -->
    <div *ngIf="!loading.active && !domainUsers?.length" class="py-4 text-center text-muted" i18n>Nothing found.</div>
</div>
