<section class="container">
    <!-- Heading -->
    <h1 *ngIf="isNew"  i18n="heading">Create domain</h1>
    <h1 *ngIf="!isNew" i18n="heading">Edit domain</h1>

    <!-- Edit form -->
    <form [formGroup]="form" [appSpinner]="loading.active" (ngSubmit)="submit()" (keydown.control.enter)="submit()" spinnerSize="lg">
        <!-- Info -->
        <div *ngIf="isNew" class="mb-3">
            <ng-container i18n>Add a domain to enable comments on it.</ng-container>
        </div>
        <!-- Host -->
        <div class="mb-3 row">
            <label for="host" class="col-sm-3 col-form-label colon" i18n>Host</label>
            <div class="col-sm-9">
                <input formControlName="host" type="text" class="form-control" id="host"
                       [class.is-valid]="isNew && ctlHost.touched && ctlHost.valid"
                       [class.is-invalid]="isNew && ctlHost.touched && ctlHost.invalid"
                       required minlength="1" maxlength="253" placeholder="example.com">
                <!-- Invalid feedback -->
                <div class="invalid-feedback">
                    <ng-container i18n>Please enter a valid domain host.</ng-container>
                </div>
                <small *ngIf="isNew" id="nameHelpBlock" class="form-text text-muted">
                    <fa-icon [icon]="faExclamationTriangle" class="me-1"></fa-icon>
                    <ng-container i18n>You won't be able to change the host once domain is created.</ng-container>
                </small>
            </div>
        </div>
        <!-- Name -->
        <div class="mb-3 row">
            <label for="name" class="col-sm-3 col-form-label colon" i18n>Name</label>
            <div class="col-sm-9">
                <input formControlName="name" type="text" class="form-control" id="name"
                       [class.is-valid]="ctlName.touched && ctlName.valid"
                       [class.is-invalid]="ctlName.touched && ctlName.invalid"
                       maxlength="255" placeholder="My blog" i18n-placeholder>
                <div class="invalid-feedback" i18n>Value is too long.</div>
            </div>
        </div>

        <!-- Comment moderation -->
        <div class="mb-3 row">
            <div class="offset-sm-3 col-sm-9">
                <!-- Subheading -->
                <div class="fw-bold mt-3 mb-1" i18n>Comment moderation</div>

<!-- TODO new-db -->
<!--                &lt;!&ndash; Require all comments to be approved manually &ndash;&gt;-->
<!--                <div class="form-check me-3">-->
<!--                    <input formControlName="requireModeration" type="checkbox" class="form-check-input" id="requireModeration">-->
<!--                    <label class="form-check-label" for="requireModeration" i18n>Require all comments to be approved manually</label>-->
<!--                </div>-->
<!--                &lt;!&ndash; Require anonymous comments to be approved manually &ndash;&gt;-->
<!--                <div class="form-check me-3">-->
<!--                    <input formControlName="moderateAllAnonymous" type="checkbox" class="form-check-input" id="moderateAllAnonymous">-->
<!--                    <label class="form-check-label" for="moderateAllAnonymous" i18n>Require anonymous comments to be approved manually</label>-->
<!--                </div>-->
            </div>
        </div>

        <!-- Comment sorting -->
        <div class="mb-3 row">
            <div class="offset-sm-3 col-sm-9">
                <!-- Subheading -->
                <div class="fw-bold mt-3 mb-1" i18n>Comment sorting</div>

                <!-- Most upvoted first -->
                <div class="form-check">
                    <input formControlName="defaultSort" class="form-check-input" type="radio" id="sortSD" value="sd">
                    <label class="form-check-label" for="sortSD" i18n>Most upvoted first</label>
                </div>
                <!-- Least upvoted first -->
                <div class="form-check">
                    <input formControlName="defaultSort" class="form-check-input" type="radio" id="sortSA" value="sa">
                    <label class="form-check-label" for="sortSA" i18n>Least upvoted first</label>
                </div>
                <!-- Newest first -->
                <div class="form-check">
                    <input formControlName="defaultSort" class="form-check-input" type="radio" id="sortTD" value="td">
                    <label class="form-check-label" for="sortTD" i18n>Newest first</label>
                </div>
                <!-- Oldest first -->
                <div class="form-check">
                    <input formControlName="defaultSort" class="form-check-input" type="radio" id="sortTA" value="ta">
                    <label class="form-check-label" for="sortTA" i18n>Oldest first</label>
                </div>
            </div>
        </div>

        <!-- Email moderators -->
        <div class="mb-3 row">
            <div class="offset-sm-3 col-sm-9">
                <!-- Subheading -->
                <div class="fw-bold mt-3 mb-1" i18n>Email moderators</div>

                <!-- Don't email -->
                <div class="form-check">
                    <input formControlName="modNotifyPolicy" class="form-check-input" type="radio" id="modNotifyPolicyNone" value="none">
                    <label class="form-check-label" for="modNotifyPolicyNone" i18n>Don't email</label>
                </div>
                <!-- Only for comments pending moderation -->
                <div class="form-check">
                    <input formControlName="modNotifyPolicy" class="form-check-input" type="radio" id="modNotifyPolicyPending" value="pending">
                    <label class="form-check-label" for="modNotifyPolicyPending" i18n>Only for comments pending moderation</label>
                </div>
                <!-- For every new comment -->
                <div class="form-check">
                    <input formControlName="modNotifyPolicy" class="form-check-input" type="radio" id="modNotifyPolicyAll" value="all">
                    <label class="form-check-label" for="modNotifyPolicyAll" i18n>For every new comment</label>
                </div>
            </div>
        </div>

        <!-- Authentication -->
        <div class="mb-3 row">
            <div class="offset-sm-3 col-sm-9">
                <!-- Subheading -->
                <div class="fw-bold mt-3 mb-1" i18n>Authentication</div>

                <!-- Anonymous comments -->
                <div class="form-check me-3">
                    <input formControlName="authAnonymous" type="checkbox" class="form-check-input" id="authAnonymous">
                    <label class="form-check-label" for="authAnonymous" i18n>Anonymous comments</label>
                </div>

                <!-- Identity providers -->
                <div formArrayName="fedIdps">
                    <!-- Local auth -->
                    <input [formControlName]="0" type="checkbox" class="form-check-input" id="auth-local">
                    <label class="form-check-label" for="auth-local" i18n>Local (password-based)</label>
                    <!-- SSO -->
                    <input [formControlName]="1" type="checkbox" class="form-check-input" id="auth-sso">
                    <label class="form-check-label" for="auth-sso" i18n>Single Sign-On</label>
                    <!-- Federated IdPs -->
                    <div *ngFor="let idp of fedIdps; index as idx" class="form-check me-3">
                        <input [formControlName]="idx+2" type="checkbox" class="form-check-input" [id]="'auth-' + idp.id">
                        <label class="form-check-label" [for]="'auth-' + idp.id">{{ idp.name }}</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Buttons -->
        <div class="form-footer">
            <a routerLink=".." class="btn btn-link" i18n="action">Cancel</a>
            <button [appSpinner]="saving.active" type="submit" class="btn btn-primary">
                <ng-container *ngIf="isNew"  i18n="action">Create</ng-container>
                <ng-container *ngIf="!isNew" i18n="action">Save</ng-container>
            </button>
        </div>
    </form>
</section>
